---
title: "Casefile: 'System Shutdown' Phish — Safe Redirect Triage + IOC Extraction"
description: "A repeatable email-triage workflow: preserve evidence, review headers, extract/defang links, safely resolve redirects (headers-only), and document IOCs + defensive actions."
date: "2024-12-14"
slug: "phishing-investigation-system-shutdown"
tags: ["dfir", "phishing", "email-security", "osint", "casefiles"]
order: 1
repo: ""
---

> **IOCs:**  
> `130.250.191.154` • `shoecatphone[.]com` • `nandakan[.]com` • `/qs=<token>` patterns

![hunting-redirect-logic](/images/phish-1/email.png)

## what this is

Got a suspicious email in my personal inbox. Instead of just deleting it, I treated it like a real incident and documented the full triage workflow. This casefile walks through safe analysis without ever clicking the link or executing anything.

**context:** Random phishing attempt I received. Analyzed it in an isolated VM for practice and to document a repeatable investigation process.

**safety constraints:**
- No browser interaction with landing pages
- No JavaScript execution  
- No credential entry or form submits
- Headers-only inspection via `curl -I` + passive recon

---

## environment

**Setup:**
- Host: macOS  
- Analysis VM: Kali Linux (VirtualBox)
- Evidence: `msg1.eml` (standalone artifact)
- Chain of custody: SHA-256 hash captured

![msg1-eml](/images/phish-1/msg1-eml.png)

```bash
# carve + preserve
sed -n '1,290p' *.eml > msg1.eml
sha256sum msg1.eml | tee msg1.sha256
```

**timeline:** ~45 minutes from email receipt to IOC extraction

---

## 1. header triage

First step: understand what the email claims to be vs. what it actually is.

![full-header-block-message-1](/images/phish-1/full-header-block-message-1.png)

```bash
# quick signal
grep -nE '^(Subject|From|Return-Path):' msg1.eml
grep -nE '^(Authentication-Results|DKIM-Signature|Received):' msg1.eml | head -n 80
```

Looking for: auth failures, suspicious sender paths, unusual routing.

---

## 2. extract the HTML body

Raw `.eml` files are messy (MIME boundaries, encoding, embedded content). Extracted the HTML part to make link hunting clean and deterministic.

![decoded-html-output](/images/phish-1/decoded-html-output.png)

Body language: classic urgency tactics ("prevent data loss" / "update payment immediately").

---

## 3. extract + defang URLs

Pull every URL, defang them to prevent accidental clicks.

![extracted-urls-from-msg1](/images/phish-1/extracted-urls-from-msg1.png)

```bash
# extract unique URLs
grep -Eo '(https?://[^"<> ]+)' msg1_body.html | sort -u > urls_raw.txt

# defang for safe handling
sed -E 's#https?://#hxxps://#g; s/[.]/[.]/g' urls_raw.txt > urls_defanged.txt
```

---

## 4. the `qs=` tokens

Links used tokenized routing markers instead of clean paths:

- `/qs=op-…`
- `/qs=r-…`  
- `/qs=ua-…`

![qs](/images/phish-1/qs.png)

**what this means:** These tokens track individual recipients and campaign variants. More sophisticated than basic phishing—suggests operational tracking infrastructure.

**detection value:** High signal. Most legitimate emails don't use `/qs=` path tokens.

---

## 5. normalize the IPv6 artifact

Embedded links used IPv6-mapped format (`::ffff:...`). Converted to IPv4 for use in blocklists and detection rules.

![ip_ioc](/images/phish-1/ip_ioc.png)

```bash
python3 << 'PY'
import ipaddress
ip6 = ipaddress.ip_address("::ffff:82fa:bf9a")
print("ipv4:", ip6.ipv4_mapped)
PY
```

**Result:** `130.250.191.154`

---

## 6. resolve redirects (headers only)

Used HEAD requests to follow redirect chains without rendering the page.

```bash
curl -sS -I --max-time 10 "http://130.250.191.154/<qs_path>" | sed -n '1,30p'
```

![shoecatphone-headers](/images/phish-1/shoecatphone-headers.png)

**Redirect chain:**  
`130.250.191.154` → **302** → `www.shoecatphone[.]com/<path>`

This is the operational outcome: multi-stage redirect infrastructure leading to a separate landing domain.

---

## 7. passive infrastructure recon

Collected DNS records and response headers from the destination domain.

```bash
dig +short A www.shoecatphone.com
dig +short AAAA www.shoecatphone.com
curl -sS -I --max-time 10 "https://www.shoecatphone.com/<path>" | sed -n '1,40p'
```

![infra-info](/images/phish-1/infra-info.png)

**Signals:** CDN/proxy characteristics (Cloudflare), common for phishing operations to mask origin infrastructure.

---

## findings

**confirmed:**
- Multi-stage redirect infrastructure (`130.250.191.154` → `shoecatphone[.]com`)
- Tokenized tracking via `/qs=` path markers
- IPv6-mapped addressing (uncommon, suspicious)
- CDN proxying on destination domain
- Urgency-driven social engineering language

**MITRE ATT&CK:**
- T1566.002: Phishing (Spearphishing Link)
- T1071.001: Web Protocols (redirect chain)
- T1583.001: Acquire Infrastructure (Domains)

---

## if this hit production

**block:**
- Domain: `shoecatphone[.]com` (DNS/proxy filter)
- IP: `130.250.191.154` (firewall/proxy where applicable)

**hunt:**
- Email gateway logs: search sender patterns + subject line
- Proxy logs: flag requests with `/qs=` paths
- Email content: scan for IPv6-mapped addresses in URLs

**detect:**
- Alert on `/qs=` token patterns in email URLs (low FP rate)
- Flag IPv6-mapped addresses (`::ffff:`) in email content
- Monitor 302 redirect chains from email-sourced clicks

**escalate:**
- Check if any users clicked (email gateway click tracking)
- Review credentials entered on landing page (if any)
- Feed IOCs to threat intel platform

---

## what I'd do differently

**gaps:**
- Should have pulled full `Received:` header chain for complete mail flow
- Could have checked VirusTotal for historical context on IP/domain
- Missed opportunity to automate defanging (wrote it manually)

**learned:**
- `/qs=` tokens are high-signal detection markers
- IPv6-mapped addresses in emails are worth flagging
- Headers-only analysis is fast and safe for initial triage

**next time:**
- Build a small Python script for auto-defanging + IOC extraction
- Create a Sentinel analytics rule for `/qs=` patterns
- Document full SMTP routing chain (not just top headers)

---

## key takeaways

- IPv6-mapped addresses in email URLs = uncommon, worth investigating
- Tokenized path routing (`/qs=`) suggests sophisticated tracking infrastructure
- Headers-only inspection is safe and effective for redirect analysis
- Multi-stage redirects complicate attribution but are traceable
- Always defang IOCs before sharing (prevents accidental execution)

---

## commands

```bash
# preserve + hash
sha256sum msg1.eml | tee msg1.sha256

# header triage
grep -nE '^(Subject|From|Return-Path):' msg1.eml
grep -nE '^(Authentication-Results|DKIM-Signature|Received):' msg1.eml | head -n 80

# extract + defang URLs
grep -Eo '(https?://[^"<> ]+)' msg1_body.html | sort -u > urls_raw.txt
sed -E 's#https?://#hxxps://#g; s/[.]/[.]/g' urls_raw.txt > urls_defanged.txt

# pull qs= tokens
grep -RhoE '/qs=[^" ]+' msg1_body.html | sort -u

# headers-only redirect
curl -sS -I --max-time 10 "http://130.250.191.154/<qs_path>" | sed -n '1,30p'

# normalize IPv6 → IPv4
python3 -c "import ipaddress; print(ipaddress.ip_address('::ffff:82fa:bf9a').ipv4_mapped)"
```

---

**seen similar patterns?** [me@heyosj.com](mailto:me@heyosj.com) • [@heyosj](https://twitter.com/heyosj)