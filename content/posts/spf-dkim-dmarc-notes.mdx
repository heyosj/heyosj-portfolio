---
title: "Email Authentication: SPF, DKIM, and DMARC"
description: "In-depth notes on email authentication, spoofing prevention, and policy configuration."
date: "2025-08-13"
slug: "spf-dkim-dmarc"
tags: ["email security", "authentication", "spf", "dkim", "dmarc"]
order: 2
favorite: true
---

> **TL;DR:** SPF limits who can send on behalf of your domain, DKIM verifies messages havenâ€™t been altered, and DMARC ties both together with policy and reporting. Too strict can block legitimate mail; too loose leaves you open to spoofing. Aim for balanced enforcement, staged rollouts, and reporting enabled.

[What is email security? | Cloudflare](https://www.cloudflare.com/learning/email-security/)  
[Cloudflare Blog: Tackling Email Spoofing](https://blog.cloudflare.com/tackling-email-spoofing/?_gl=1*ocnswq*_gcl_au*NTYyNTM4NDc3LjE3MTUwMTkzOTE.*_ga*NjhiMzgwOTYtZDA1NC00NGQyLTliYTMtZDBiOTJjNzM2NmI0*_ga_SQCRB0TXZW*MTcyMjYxNDg4NS42LjEuMTcyMjYxNDkxNS4wLjAuMA)

## Goals
- Review and recommend improvements to SPF/DKIM/DMARC.
- Implement SMTP TLS reporting for inbound emails.
- Implement MTA-STS for inbound emails.

## How They Work
Email service providers check messages against SPF, DKIM, and DMARC to verify:
- **Origin authenticity** â€” The message came from an authorized source.
- **Integrity** â€” It hasnâ€™t been modified in transit.
- **Policy compliance** â€” The domain ownerâ€™s rules are followed.

These are DNS-based anti-spoofing mechanisms:
1. **SPF** â€“ Sender Policy Framework  
2. **DKIM** â€“ DomainKeys Identified Mail  
3. **DMARC** â€“ Domain-based Message Authentication Reporting & Conformance  

---

## Concerns
- **Too strict:** Legitimate messages can be blocked or flagged as spam.
- **Too relaxed:** Your domain can be abused for spoofing/phishing.

---

## SPF â€” Sender Policy Framework
SPF lists which IP addresses and domains are allowed to send on behalf of your domain.

- Published as a TXT DNS record starting with `v=spf1`.
- `include:` references another domainâ€™s SPF record.
- Ends with a **qualifier**:
  - `+all` (Allow) â€” **Not recommended**, allows anyone.
  - `~all` (SoftFail) â€” Marks as suspicious; different servers may spam-flag or warn.
  - `-all` (Fail) â€” Rejects messages from non-listed sources.

ðŸ’¡ **SPFâ€™s role:** Only explicitly listed IPs/domains can send for you. Others are denied, soft-failed, or allowed depending on your qualifier.

**Example:**  
If the sending IP isnâ€™t listed:
1. Apply `~all` to soft-fail.
2. Pass to DKIM and DMARC for additional checks.
3. The receiving system (e.g., Exchange) makes the final deliver/spam/block decision.

---

## DKIM â€” DomainKeys Identified Mail
DKIM signs parts of an email (headers, body) with a private key. The recipient fetches the public key from DNS to verify.

- TXT record format: `<selector>._domainkey.<domain>`.
- Starts with `v=DKIM1` followed by:
  - `k=` key type (e.g., rsa)
  - `p=` public key
- Independent from SPF â€” both checks run separately.

ðŸ’¡ **DKIMâ€™s role:** Confirms that the message content hasnâ€™t been altered and that it came from the domain that signed it.

---

## DMARC â€” Domain-based Message Authentication Reporting & Conformance
DMARC integrates SPF and DKIM results, defines a handling policy, and sends reports.

- TXT record at `_dmarc.<domain>` starting with `v=DMARC1`.
- Key tags:
  - `p=` policy:  
    - `none` â€” Monitor only.  
    - `quarantine` â€” Send failures to spam/junk.  
    - `reject` â€” Drop failures entirely.  
  - `pct=` â€” Apply policy to a percentage of traffic (useful for gradual rollout).  
  - `rua=` â€” Address for aggregate reports.

ðŸ’¡ Without DMARC, recipients apply their own handling rules for SPF/DKIM failures, leading to inconsistency and no feedback.

---

## Why This Matters
- Without **DMARC**, SPF/DKIM failures may still slip through or be handled inconsistently.
- With **DMARC**, you set the rules and get reports â€” helping identify spoof attempts and misconfigurations.

---

## Conclusion
- **SPF with `-all`**: Strictly block unauthorized senders.
- **DKIM**: Validate email authenticity and integrity with cryptographic signatures.
- **DMARC with `p=reject`**: Block unauthenticated emails and collect reports for visibility.

---
